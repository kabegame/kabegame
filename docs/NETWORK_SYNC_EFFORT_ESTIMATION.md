# 网络同步功能人力评估

## 1. 功能模块分解

### 1.1 阶段一：基础框架

#### 后端开发（Rust）

**HTTP 服务器（axum）**
- **新增文件**：`src-tauri/daemon/src/http_server/mod.rs`
  - HTTP 服务器结构体：约 100 行
  - 路由配置：约 150 行
  - 中间件（CORS、日志等）：约 100 行
  - **小计**：约 350 行
  - **工作量**：3 人天
  - **复杂度**：中

**IPC 客户端**
- **新增文件**：`src-tauri/core/src/ipc/client.rs`
  - IPC 客户端实现：约 200 行
  - Unix Socket / Named Pipe 支持：约 150 行
  - 错误处理：约 50 行
  - **小计**：约 400 行
  - **工作量**：3 人天
  - **复杂度**：中

**IPC 请求转换**
- **修改文件**：`src-tauri/daemon/src/http_server/handlers.rs`
  - HTTP → IPC 转换：约 150 行
  - IPC → HTTP 转换：约 100 行
  - 错误处理和状态码映射：约 80 行
  - **小计**：约 330 行
  - **工作量**：2.5 人天
  - **复杂度**：中

**Provider API 端点**
- **修改文件**：`src-tauri/daemon/src/http_server/handlers.rs`
  - `/api/provider` 端点：约 100 行
  - `/api/provider/*path` 端点：约 150 行
  - `/api/provider/*path/file/:name` 端点：约 100 行
  - 响应格式转换：约 80 行
  - **小计**：约 430 行
  - **工作量**：3 人天
  - **复杂度**：中

**基础安全机制**
- **新增文件**：`src-tauri/daemon/src/http_server/middleware.rs`
  - 密码认证中间件：约 150 行
  - 访问控制检查：约 100 行
  - 速率限制：约 120 行
  - **小计**：约 370 行
  - **工作量**：3 人天
  - **复杂度**：高

**Daemon 集成**
- **修改文件**：`src-tauri/daemon/src/main.rs`
  - HTTP 服务器启动：约 50 行
  - 配置管理：约 30 行
  - **小计**：约 80 行
  - **工作量**：1 人天
  - **复杂度**：低

**后端阶段一小计**：约 1960 行，15.5 人天

#### 前端开发（TypeScript/Vue）

**设备管理 UI**
- **新增文件**：`apps/main/src/views/NetworkSync.vue`
  - 设备列表：约 200 行
  - 设备发现设置：约 150 行
  - 手动添加设备：约 100 行
  - 样式：约 100 行
  - **小计**：约 550 行
  - **工作量**：4 人天
  - **复杂度**：中

**插件 peer 变量支持**
- **修改文件**：`apps/main/src/components/CrawlerDialog.vue`
  - peer 变量渲染：约 80 行
  - 设备选择器：约 120 行
  - **小计**：约 200 行
  - **工作量**：2 人天
  - **复杂度**：中

**前端阶段一小计**：约 750 行，6 人天

#### 测试
- **单元测试**：约 400 行，2 人天
- **集成测试**：约 300 行，2 人天

**测试小计**：约 700 行，4 人天

**阶段一小计**：约 3410 行，25.5 人天（约 5 周，1 人全职）

---

### 1.2 阶段二：网络虚拟盘

#### 后端开发（Rust）

**NetworkProvider 实现**
- **新增文件**：`src-tauri/core/src/providers/network.rs`
  - `NetworkProvider` 结构体：约 150 行
  - `Provider` trait 实现：约 300 行
  - HTTP 客户端：约 200 行
  - 缓存管理：约 150 行
  - **小计**：约 800 行
  - **工作量**：6 人天
  - **复杂度**：高

**NetworkGroupProvider 实现**
- **修改文件**：`src-tauri/core/src/providers/network.rs`
  - `NetworkGroupProvider` 实现：约 200 行
  - 设备列表管理：约 100 行
  - **小计**：约 300 行
  - **工作量**：2.5 人天
  - **复杂度**：中

**RootProvider 扩展**
- **修改文件**：`src-tauri/core/src/providers/root.rs`
  - 添加网络设备入口：约 50 行
  - **小计**：约 50 行
  - **工作量**：0.5 人天
  - **复杂度**：低

**虚拟盘集成**
- **修改文件**：`src-tauri/core/src/virtual_drive/windows.rs`
  - 网络 Provider 支持：约 100 行
  - **小计**：约 100 行
  - **工作量**：1 人天
  - **复杂度**：中

**后端阶段二小计**：约 1250 行，10 人天

#### 前端开发（TypeScript/Vue）

**网络设备浏览**
- **修改文件**：`apps/main/src/views/Gallery.vue`
  - 网络 Provider 路径支持：约 100 行
  - **小计**：约 100 行
  - **工作量**：1 人天
  - **复杂度**：低

**前端阶段二小计**：约 100 行，1 人天

#### 测试
- **单元测试**：约 300 行，1.5 人天
- **集成测试**：约 200 行，1.5 人天

**测试小计**：约 500 行，3 人天

**阶段二小计**：约 1850 行，14 人天（约 3 周，1 人全职）

---

### 1.3 阶段三：设备发现与管理

#### 后端开发（Rust）

**设备发现架构**
- **新增文件**：`src-tauri/core/src/network/discovery/mod.rs`
  - `DeviceDiscoverer` trait：约 50 行
  - `DiscoveryManager`：约 300 行
  - **小计**：约 350 行
  - **工作量**：3 人天
  - **复杂度**：中

**mDNS 发现器**
- **新增文件**：`src-tauri/core/src/network/discovery/mdns.rs`
  - mDNS 服务广播：约 200 行
  - mDNS 设备发现：约 250 行
  - **小计**：约 450 行
  - **工作量**：4 人天
  - **复杂度**：高

**手动配置发现器**
- **新增文件**：`src-tauri/core/src/network/discovery/manual.rs`
  - 手动设备管理：约 150 行
  - **小计**：约 150 行
  - **工作量**：1 人天
  - **复杂度**：低

**局域网扫描发现器（可选）**
- **新增文件**：`src-tauri/core/src/network/discovery/lan_scan.rs`
  - IP 段扫描：约 200 行
  - 并发扫描：约 150 行
  - **小计**：约 350 行
  - **工作量**：3 人天
  - **复杂度**：中

**UPnP/SSDP 发现器（可选）**
- **新增文件**：`src-tauri/core/src/network/discovery/upnp.rs`
  - SSDP 协议实现：约 300 行
  - **小计**：约 300 行
  - **工作量**：3 人天
  - **复杂度**：中

**蓝牙发现器（可选）**
- **新增文件**：`src-tauri/core/src/network/discovery/bluetooth.rs`
  - 蓝牙设备扫描：约 250 行
  - **小计**：约 250 行
  - **工作量**：3 人天
  - **复杂度**：中

**设备管理器**
- **新增文件**：`src-tauri/core/src/network/device_manager.rs`
  - 设备列表管理：约 200 行
  - 设备状态跟踪：约 150 行
  - 自动刷新机制：约 100 行
  - **小计**：约 450 行
  - **工作量**：3 人天
  - **复杂度**：中

**后端阶段三小计**：约 2300 行（含所有发现器）或 1400 行（仅 mDNS + 手动），17 人天（含所有发现器）或 11 人天（仅 mDNS + 手动）

#### 前端开发（TypeScript/Vue）

**设备发现设置 UI**
- **修改文件**：`apps/main/src/views/NetworkSync.vue`
  - 发现器配置：约 150 行
  - 发现器特定配置：约 100 行
  - **小计**：约 250 行
  - **工作量**：2 人天
  - **复杂度**：中

**设备列表显示增强**
- **修改文件**：`apps/main/src/views/NetworkSync.vue`
  - 设备状态显示：约 100 行
  - 自动刷新：约 50 行
  - **小计**：约 150 行
  - **工作量**：1 人天
  - **复杂度**：低

**前端阶段三小计**：约 400 行，3 人天

#### 测试
- **单元测试**：约 400 行，2 人天
- **集成测试**：约 300 行，2 人天

**测试小计**：约 700 行，4 人天

**阶段三小计**：约 3400 行（含所有发现器）或 2500 行（仅 mDNS + 手动），24 人天（含所有发现器）或 18 人天（仅 mDNS + 手动）（约 5 周，1 人全职）

---

### 1.4 阶段四：嵌套访问

#### 后端开发（Rust）

**转发 API 实现**
- **修改文件**：`src-tauri/daemon/src/http_server/handlers.rs`
  - `/api/forward/:device/provider/*path` 端点：约 200 行
  - 请求转发逻辑：约 150 行
  - **小计**：约 350 行
  - **工作量**：3 人天
  - **复杂度**：高

**NestedNetworkProvider 实现**
- **新增文件**：`src-tauri/core/src/providers/nested_network.rs`
  - `NestedNetworkProvider` 实现：约 300 行
  - `NestedNetworkGroupProvider` 实现：约 200 行
  - 循环检测：约 150 行
  - **小计**：约 650 行
  - **工作量**：5 人天
  - **复杂度**：高

**性能优化**
- **修改文件**：多个文件
  - 缓存优化：约 100 行
  - 并发优化：约 80 行
  - **小计**：约 180 行
  - **工作量**：2 人天
  - **复杂度**：中

**后端阶段四小计**：约 1180 行，10 人天

#### 前端开发（TypeScript/Vue）

**嵌套网络路径支持**
- **修改文件**：`apps/main/src/views/Gallery.vue`
  - 嵌套路径导航：约 80 行
  - **小计**：约 80 行
  - **工作量**：1 人天
  - **复杂度**：低

**前端阶段四小计**：约 80 行，1 人天

#### 测试
- **单元测试**：约 200 行，1 人天
- **集成测试**：约 200 行，1.5 人天

**测试小计**：约 400 行，2.5 人天

**阶段四小计**：约 1660 行，13.5 人天（约 3 周，1 人全职）

---

## 2. 总人力评估

### 2.1 按阶段汇总

| 阶段 | 后端 | 前端 | 测试 | 小计 |
|------|------|------|------|------|
| 阶段一：基础框架 | 15.5 | 6 | 4 | 25.5 |
| 阶段二：网络虚拟盘 | 10 | 1 | 3 | 14 |
| 阶段三：设备发现与管理 | 11-17 | 3 | 4 | 18-24 |
| 阶段四：嵌套访问 | 10 | 1 | 2.5 | 13.5 |
| **总计** | **46.5-52.5** | **11** | **13.5** | **71-76** |

### 2.2 按角色汇总

- **后端开发（Rust）**：46.5-52.5 人天（约 9-10.5 周）
- **前端开发（TypeScript/Vue）**：11 人天（约 2 周）
- **测试**：13.5 人天（约 2.5 周）

### 2.3 代码量估算

- **后端代码（Rust）**：约 6700-7500 行
- **前端代码（TypeScript/Vue）**：约 1330 行
- **测试代码**：约 2300 行
- **总代码量**：约 **10330-11130 行**

### 2.4 团队配置建议

#### 方案 A：1 人全职（串行开发）
- **总时长**：约 14-15 周（3.5 个月）
- **优点**：人力成本低，代码风格统一
- **缺点**：开发周期长

#### 方案 B：2 人并行（后端 + 前端）（推荐）
- **后端开发**：1 人，9-10.5 周
- **前端开发**：1 人，2 周（可提前开始，依赖后端接口）
- **测试**：后端完成后 2.5 周
- **总时长**：约 11.5-13 周（3 个月）
- **优点**：开发周期短，并行开发效率高
- **缺点**：需要协调接口

#### 方案 C：3 人团队（后端 + 前端 + 测试）
- **后端开发**：1 人，9-10.5 周
- **前端开发**：1 人，2 周
- **测试**：1 人，与开发并行，2.5 周集中测试
- **总时长**：约 10.5-11 周（2.5 个月）
- **优点**：开发周期最短，质量有保障
- **缺点**：人力成本最高

### 2.5 风险因素

#### 高风险项（可能增加 20-30% 工作量）
1. **mDNS 跨平台支持**：不同平台的 mDNS 实现差异
2. **IPC 客户端实现**：Unix Socket / Named Pipe 跨平台兼容
3. **嵌套访问循环检测**：复杂的循环检测逻辑
4. **性能优化**：大量设备场景的性能问题

#### 中风险项（可能增加 10-15% 工作量）
1. **HTTP 服务器集成**：与 daemon 的集成
2. **安全机制**：密码认证、速率限制
3. **设备发现**：多种发现器的协调
4. **缓存管理**：网络文件的缓存策略

#### 低风险项（可能增加 5% 工作量）
1. **UI 组件**：主要是复用现有组件
2. **Provider 扩展**：复用现有 Provider 架构

### 2.6 可选功能

以下功能为可选，可以后续迭代：

- **局域网扫描发现器**：+3 人天
- **UPnP/SSDP 发现器**：+3 人天
- **蓝牙发现器**：+3 人天

如果只实现核心功能（mDNS + 手动配置），总工作量可以减少约 9 人天。

### 2.7 建议

1. **分阶段实施**：按照阶段一、二、三、四的顺序实施，每个阶段可以独立交付价值
2. **优先核心功能**：阶段一和阶段二是核心，阶段三可以只实现 mDNS + 手动配置，阶段四可以后续迭代
3. **并行开发**：建议采用方案 B（2 人并行），在保证质量的前提下缩短开发周期
4. **预留缓冲时间**：建议在总工作量基础上增加 20% 的缓冲时间，应对风险
5. **可选功能延后**：局域网扫描、UPnP、蓝牙发现器可以后续迭代

---

**评估日期**：2025-01-15  
**评估人**：AI Assistant  
**文档版本**：v1.0
