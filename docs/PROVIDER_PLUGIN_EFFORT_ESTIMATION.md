# Provider 插件系统人力评估

## 1. 功能模块分解

### 1.1 远程 URL 支持（阶段一）

#### 后端开发（Rust）
- **FsEntry 扩展**：添加 `RemoteFile` 类型
  - 工作量：0.5 人天
  - 复杂度：低（数据结构扩展）
  
- **ImageInfo 扩展**：添加 `source_type`、`url`、`thumbnail_url`、`original_url` 字段
  - 工作量：0.5 人天
  - 复杂度：低（数据结构扩展）
  
- **Storage 扩展**：添加 `find_image_by_url` 方法，添加 `url` 字段到数据库
  - 工作量：1 人天
  - 复杂度：中（数据库迁移 + 查询逻辑）
  
- **RemoteImageLoader**：实现远程图片加载器
  - 工作量：3 人天
  - 复杂度：高（集成 download_image worker、缓存管理、URL 去重）
  
- **download_image worker 集成**：支持 Provider 图片下载
  - 工作量：2 人天
  - 复杂度：中（任务管理、错误处理）
  
- **缓存管理**：缓存目录管理、清理策略
  - 工作量：1 人天
  - 复杂度：中（缓存策略、清理逻辑）

**后端小计**：8 人天

#### 前端开发（TypeScript/Vue）
- **ImageInfo 类型扩展**：添加远程 URL 相关字段
  - 工作量：0.5 人天
  - 复杂度：低（类型定义）
  
- **useImageUrlLoader 修改**：支持远程 URL 加载
  - 工作量：3 人天
  - 复杂度：高（逻辑复杂、需要处理多种情况）
  
- **ImageItem 组件**：添加远程图片标识、下载按钮
  - 工作量：1.5 人天
  - 复杂度：中（UI 组件、交互逻辑）
  
- **下载按钮实现**：右上角下载按钮（和任务失败图片按钮一样）
  - 工作量：1 人天
  - 复杂度：低（复用现有组件）
  
- **错误处理和加载状态**：远程图片加载失败处理
  - 工作量：1 人天
  - 复杂度：中（错误处理、状态管理）

**前端小计**：7 人天

#### 测试
- **单元测试**：后端和前端核心逻辑测试
  - 工作量：2 人天
  - 复杂度：中
  
- **集成测试**：端到端测试
  - 工作量：2 人天
  - 复杂度：中

**测试小计**：4 人天

**阶段一小计**：19 人天（约 4 周，1 人全职）

---

### 1.2 Provider 插件基础（阶段二）

#### 后端开发（Rust）
- **PluginProvider 实现**：核心 Provider 实现
  - 工作量：5 人天
  - 复杂度：高（Provider trait 实现、脚本执行）
  
- **Provider Rhai API**：为 Provider 脚本提供 API
  - 工作量：4 人天
  - 复杂度：高（API 设计、Rhai 集成）
  
- **ProviderDescriptor 扩展**：添加 Plugin 类型
  - 工作量：1 人天
  - 复杂度：低（枚举扩展）
  
- **RootProvider 集成**：在根 Provider 中显示插件 Provider
  - 工作量：1 人天
  - 复杂度：低（列表扩展）
  
- **Provider 脚本加载**：从插件包中加载 provider.rhai
  - 工作量：2 人天
  - 复杂度：中（文件读取、错误处理）

**后端小计**：13 人天

#### 前端开发（TypeScript/Vue）
- **画廊 Provider 路径支持**：支持浏览插件 Provider 路径
  - 工作量：2 人天
  - 复杂度：中（路径解析、导航）
  
- **useGalleryProvider**：画廊 Provider 浏览 composable
  - 工作量：2 人天
  - 复杂度：中（状态管理、API 调用）
  
- **路径导航增强**：支持插件 Provider 路径导航
  - 工作量：1.5 人天
  - 复杂度：低（UI 增强）
  
- **混合来源图片列表**：支持本地和远程图片混合显示
  - 工作量：2 人天
  - 复杂度：中（数据转换、显示逻辑）

**前端小计**：7.5 人天

#### 测试
- **单元测试**：Provider 脚本执行测试
  - 工作量：2 人天
  - 复杂度：中
  
- **集成测试**：插件 Provider 端到端测试
  - 工作量：2 人天
  - 复杂度：中

**测试小计**：4 人天

**阶段二小计**：24.5 人天（约 5 周，1 人全职）

---

### 1.3 Provider DSL（阶段三）

#### 后端开发（Rust）
- **Rhai DSL 支持**：Provider 脚本执行引擎
  - 工作量：6 人天
  - 复杂度：高（脚本解析、执行、错误处理）
  
- **Provider API 完善**：完善所有 Provider API
  - 工作量：3 人天
  - 复杂度：中（API 设计、实现）
  
- **错误处理和调试**：脚本错误处理、调试信息
  - 工作量：2 人天
  - 复杂度：中（错误处理、日志）
  
- **JSON DSL 支持**（可选）：简单 Provider 的 JSON 配置
  - 工作量：3 人天
  - 复杂度：中（配置解析、转换）

**后端小计**：14 人天（含 JSON DSL）或 11 人天（不含 JSON DSL）

#### 前端开发（TypeScript/Vue）
- **插件编辑器增强**：支持编辑 provider.rhai
  - 工作量：2 人天
  - 复杂度：低（编辑器集成）
  
- **Provider 脚本调试**：调试工具和错误提示
  - 工作量：2 人天
  - 复杂度：中（调试 UI、错误显示）

**前端小计**：4 人天

#### 文档
- **Provider 插件开发文档**：编写开发指南
  - 工作量：2 人天
  - 复杂度：低
  
- **API 文档**：Provider Rhai API 文档
  - 工作量：1 人天
  - 复杂度：低

**文档小计**：3 人天

#### 测试
- **DSL 测试**：各种 Provider 脚本场景测试
  - 工作量：3 人天
  - 复杂度：中

**测试小计**：3 人天

**阶段三小计**：24 人天（含 JSON DSL）或 21 人天（不含 JSON DSL）（约 5 周，1 人全职）

---

### 1.4 高级功能（阶段四）

#### 后端开发（Rust）
- **混合视图支持**：本地和远程图片混合显示优化
  - 工作量：2 人天
  - 复杂度：中
  
- **缓存管理优化**：缓存策略优化、自动清理
  - 工作量：2 人天
  - 复杂度：中
  
- **性能优化**：大量数据场景优化
  - 工作量：3 人天
  - 复杂度：高（性能调优）

**后端小计**：7 人天

#### 前端开发（TypeScript/Vue）
- **性能优化**：大量图片加载优化
  - 工作量：2 人天
  - 复杂度：中
  
- **用户体验优化**：加载状态、占位图、重试机制
  - 工作量：2 人天
  - 复杂度：中

**前端小计**：4 人天

#### 测试
- **性能测试**：大量数据场景测试
  - 工作量：1 人天
  - 复杂度：中

**测试小计**：1 人天

**阶段四小计**：12 人天（约 2.5 周，1 人全职）

---

## 2. 总人力评估

### 2.1 按阶段汇总

| 阶段 | 后端 | 前端 | 测试 | 文档 | 小计 |
|------|------|------|------|------|------|
| 阶段一：远程 URL 支持 | 8 | 7 | 4 | 0 | 19 |
| 阶段二：Provider 插件基础 | 13 | 7.5 | 4 | 0 | 24.5 |
| 阶段三：Provider DSL | 11-14 | 4 | 3 | 3 | 21-24 |
| 阶段四：高级功能 | 7 | 4 | 1 | 0 | 12 |
| **总计** | **39-42** | **22.5** | **12** | **3** | **76.5-81.5** |

### 2.2 按角色汇总

- **后端开发（Rust）**：39-42 人天（约 8-8.5 周）
- **前端开发（TypeScript/Vue）**：22.5 人天（约 4.5 周）
- **测试**：12 人天（约 2.5 周）
- **文档**：3 人天（约 0.5 周）

### 2.3 团队配置建议

#### 方案 A：1 人全职（串行开发）
- **总时长**：约 15-16 周（3.5-4 个月）
- **优点**：人力成本低，代码风格统一
- **缺点**：开发周期长

#### 方案 B：2 人并行（后端 + 前端）
- **后端开发**：1 人，8-8.5 周
- **前端开发**：1 人，4.5 周（可提前开始，依赖后端接口）
- **测试**：后端完成后 2.5 周
- **总时长**：约 10-11 周（2.5 个月）
- **优点**：开发周期短，并行开发效率高
- **缺点**：需要协调接口

#### 方案 C：3 人团队（后端 + 前端 + 测试）
- **后端开发**：1 人，8-8.5 周
- **前端开发**：1 人，4.5 周
- **测试**：1 人，与开发并行，2.5 周集中测试
- **总时长**：约 8.5-9 周（2 个月）
- **优点**：开发周期最短，质量有保障
- **缺点**：人力成本最高

### 2.4 风险因素

#### 高风险项（可能增加 20-30% 工作量）
1. **download_image worker 集成**：需要深入理解现有下载队列机制
2. **Provider Rhai API 设计**：需要设计良好的 API，避免后续重构
3. **性能优化**：大量远程图片场景的性能问题

#### 中风险项（可能增加 10-15% 工作量）
1. **URL 去重逻辑**：URL 规范化、哈希计算
2. **缓存管理**：缓存策略、清理机制
3. **错误处理**：各种边界情况的处理

#### 低风险项（可能增加 5% 工作量）
1. **UI 组件**：主要是复用现有组件
2. **类型定义**：数据结构扩展

### 2.5 建议

1. **分阶段实施**：按照阶段一、二、三、四的顺序实施，每个阶段可以独立交付价值
2. **优先实现核心功能**：阶段一和阶段二是核心，阶段三和阶段四可以后续迭代
3. **并行开发**：建议采用方案 B（2 人并行），在保证质量的前提下缩短开发周期
4. **预留缓冲时间**：建议在总工作量基础上增加 20% 的缓冲时间，应对风险

---

**评估日期**：2025-01-15  
**评估人**：AI Assistant  
**文档版本**：v1.0
